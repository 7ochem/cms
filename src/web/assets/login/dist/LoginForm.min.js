"use strict";class LoginForm{constructor(){this.authenticationEndpoint="authentication/perform-authentication",this.recoverEndpoint="authentication/recover-account",this.$loginForm=$("#login-form"),this.$authContainer=$("#authentication-container"),this.$recoverContainer=$("#recovery-container"),this.$errors=$("#login-errors"),this.$messages=$("#login-messages"),this.$spinner=$("#spinner"),this.$pendingSpinner=$("#spinner-pending"),this.$submit=$("#submit"),this.$rememberMeCheckbox=$("#rememberMe"),this.$cancelRecover=$("#cancel-recover"),this.$recoverAccount=$("#recover-account"),this.showingRecoverForm=!1,this.$loginForm.on("submit",this.invokeStepHandler.bind(this)),this.$pendingSpinner.length&&this.$loginForm.trigger("submit"),this.$recoverAccount.on("click",this.switchForm.bind(this)),this.$cancelRecover.on("click",this.switchForm.bind(this))}performStep(e){let t,r,s;e.scenario=Craft.cpLoginChain,this.$rememberMeCheckbox.prop("checked")&&(e.rememberMe=!0),this.clearMessages(),this.clearErrors(),this.showingRecoverForm?(s=this.recoverEndpoint,t=this.$recoverContainer,r="recoveryStepHandler"):(s=this.authenticationEndpoint,t=this.$authContainer,r="authenticationStepHandler"),Craft.postActionRequest(s,e,(e,s)=>{var i;"success"==s&&(e.success&&(null===(i=e.returnUrl)||void 0===i?void 0:i.length)?window.location.href=e.returnUrl:(e.error&&(this.showError(e.error),Garnish.shake(this.$loginForm)),e.message&&this.showMessage(e.message),e.html&&(t.html(e.html),this[r]=void 0),e.footHtml&&Craft.appendFootHtml(e.footHtml),e.stepComplete&&(this.$rememberMeCheckbox.parent().remove(),this.$cancelRecover.remove(),this.$recoverAccount.remove()))),this.enableForm()})}showError(e){this.clearErrors(),$('<p style="display: none;">'+e+"</p>").appendTo(this.$errors).velocity("fadeIn")}showMessage(e){this.clearMessages(),$('<p style="display: none;">'+e+"</p>").appendTo(this.$messages).velocity("fadeIn")}registerStepHandler(e,t=!1){t?this.recoveryStepHandler=e:this.authenticationStepHandler=e}invokeStepHandler(e){const t=this.showingRecoverForm?this.recoveryStepHandler:this.authenticationStepHandler;if("function"==typeof t){const r=t(e);"object"==typeof r?(this.disableForm(),this.performStep(r)):this.showError(r)}else this.performStep({});return!1}clearErrors(){this.$errors.empty()}switchForm(){this.$authContainer.toggleClass("hidden"),this.$recoverContainer.toggleClass("hidden"),this.$cancelRecover.toggleClass("hidden"),this.$recoverAccount.toggleClass("hidden"),this.showingRecoverForm=!this.showingRecoverForm}clearMessages(){this.$messages.empty()}enableForm(){this.$submit.addClass("active"),this.$spinner.addClass("hidden")}disableForm(){this.$submit.removeClass("active"),this.$spinner.removeClass("hidden")}}Craft.LoginForm=new LoginForm;
//# sourceMappingURL=LoginForm.min.js.map
