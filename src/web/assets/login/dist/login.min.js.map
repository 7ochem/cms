{"version":3,"sources":["login/src/login.js"],"names":["$","LoginForm","Garnish","Base","extend","$form","$loginNameInput","$passwordInput","$rememberMeCheckbox","$forgotPasswordLink","$rememberPasswordLink","$submitBtn","$spinner","$errors","validateOnInput","PasswordInput","onToggleInput","$newPasswordInput","addListener","this","removeListener","val","clearErrors","validate","forgotPassword","length","event","preventDefault","onSubmit","addClass","submitForgotPassword","showError","Craft","t","removeClass","postActionRequest","MessageSentModal","data","onSubmitResponse","proxy","response","textStatus","error","submitLogin","loginName","rememberMe","prop","success","window","location","href","returnUrl","shake","trigger","base","$container","appendTo","velocity","empty","onSwitchForm","isMobileBrowser","toggleClass","text","Modal","init","$bod","hide","jQuery"],"mappings":"CAAA,SAACA,GAEG,IAAAC,EAAAC,QAAAC,KAAAC,OACIH,CAEWI,MADX,KAEIC,gBAFJ,KAGIC,eAHJ,KAIIC,oBAJJ,KAKIC,oBALJ,KAMIC,sBANJ,KAOIC,WAPJ,KAQYC,SARZ,KASWC,QATX,KAYIC,gBAZJ,EAcUA,iBAAW,EAERR,KAAAA,WACAC,KAAAA,MAAkBP,EAAC,eACnBQ,KAAAA,gBAAwBR,EAAA,cACxBS,KAAAA,eAAwBT,EAAA,aACxBU,KAAAA,oBAA0BV,EAAA,eAC1BW,KAALF,oBAAAT,EAAA,oBACKY,KAALF,sBAAAV,EAAA,sBACKa,KAAUb,WAAEA,EAAA,WAEPe,KAAAA,SAAcf,EAAA,YACpBgB,KAAaH,QAAUb,EAAA,iBAEdO,IAAAA,MAAAA,cAAiBU,KAAAA,eAAtB,CACKC,cAAiBX,EAAAA,OAAAA,SAAgBU,GAH3BE,KAAAC,eAAAD,KAAAZ,eAAA,SADnBY,KAAAZ,eAAAU,EAQiBE,KAAKb,YAAAA,KAAiBC,eAAS,QAAhD,aACiBY,QAGZD,KAAAA,YAALC,KAA6Bb,gBAA7B,QAAA,WArCRa,KAAAD,YAAAC,KAAAZ,eAAA,QAAA,WAwCcY,KAAAD,YAAWC,KAAAV,oBAAA,QAAA,gBACRH,KAAAA,YAAgBe,KAArBX,sBAA+B,QAA4BH,gBACtDe,KAAAA,YAALH,KAAAd,MAAA,SAAA,aAIAkB,SAAA,WACH,SAAAJ,KAAAb,gBAAAe,SAAAF,KAAAK,gBAAAL,KAAAZ,eAAAc,MAAAI,QAAA,MA/CTN,KAAAG,eAkDsBI,IAQRC,QAAAA,SAAND,GAPIP,KAAKL,iBASCS,KAALA,YAIJK,SAAA,SAAAF,GAKIJ,GAHAX,EAAWkB,kBAGXP,KAALC,WAGSO,OAXLX,KAAKY,UAAUC,MAAMC,EAAE,MAAO,4EAUzBT,KAAAA,iBAAgB,GAKxBL,KAAAR,WAAAkB,SAAA,UA5ETV,KAAAP,SAAAsB,YAAA,UAgFgBf,KAAGG,cAAXH,KAAAK,eAIMW,KAAAA,uBAGUC,KAAAA,eAKXN,qBAAA,WAZL,IAAIO,EAAO,CAcFC,UAALnB,KAAAb,gBAAAe,OAIGW,MAAEG,kBAAW,kCAAAE,EAAArC,EAAAuC,OAAA,SAAAC,EAAAC,GACT,YAAAA,IACSnC,EAAAA,QACDC,IAAAA,EAIb4B,KAAkBJ,UAAxBS,EAA8CE,QAKjCvB,KAAAmB,qBACMnB,QAIPwB,YAAKZ,WACR,IAAAM,EAAA,CAEAO,UAAAzB,KAAAb,gBAAAe,MACIiB,SAAAA,KAAL/B,eAAAc,MACHwB,WAAA1B,KAAAX,oBAAAsC,KAAA,WAAA,IAAA,IA8BAtB,OAtJbQ,MAAAG,kBAAA,cAAAE,EAAArC,EAAAuC,OAAA,SAAAC,EAAAC,GA8HiC,YAAXA,EACEP,EAAYa,QAC5BC,OAAuBC,SAAvBC,KAAAV,EAAAW,WAIAjD,QAAAkD,MAAAjC,KAAAd,OAEEc,KAAAmB,mBAMFnB,KAAAY,UAAAS,EAAAE,QAKSpC,KAAgB+C,qBAxBtBlC,QA6BEK,GAIRc,iBAAA,WA3JTnB,KAAAR,WAAAuB,YAAA,UA+JIE,KAAAA,SAAmBlC,SAAcE,WAMpBkD,UAAKC,SAAVb,GALRvB,KAAAG,cADJtB,EAAA,6BAAA0C,EAAA,QAcAc,SAAArC,KAAAN,SAhLJ4C,SAAA,WA+IYnC,YAAa,WACTH,KAAKN,QAAQ6C,SAGjBC,aAAc,SAASjC,GACdxB,QAAQ0D,mBACTzC,KAAKb,gBAAgB+C,QAAQ,SAGjClC,KAAKG,cAELH,KAAKK,gBAAkBL,KAAKK,eAE5BL,KAAKd,MAAMwD,YAAY,iBAAkB1C,KAAKK,gBAC9CL,KAAKR,WAAWmD,KAAK9B,MAAMC,EAAE,MAAOd,KAAKK,eAAiB,iBAAkB,aAKpFY,EAAmBlC,QAAQ6D,MAAM3D,OACjC,CACI4D,KAAM,WACF,IAAIT,EAAavD,EAAE,0DAA4DgC,MAAMC,EAAE,MAAO,6DAA+D,gBACxJuB,SAAStD,QAAQ+D,MAEtB9C,KAAKmC,KAAKC,IAGdW,KAAM,eAKd,IAAIjE,EAhLR,CAiLGkE","file":"login.min.js","sourcesContent":["(function($) {\n    /** global: Craft */\n    /** global: Garnish */\n    var LoginForm = Garnish.Base.extend(\n        {\n            $form: null,\n            $loginNameInput: null,\n            $passwordInput: null,\n            $rememberMeCheckbox: null,\n            $forgotPasswordLink: null,\n            $rememberPasswordLink: null,\n            $submitBtn: null,\n            $spinner: null,\n            $errors: null,\n\n            forgotPassword: false,\n            validateOnInput: false,\n\n            init: function() {\n                this.$form = $('#login-form');\n                this.$loginNameInput = $('#loginName');\n                this.$passwordInput = $('#password');\n                this.$rememberMeCheckbox = $('#rememberMe');\n                this.$forgotPasswordLink = $('#forgot-password');\n                this.$rememberPasswordLink = $('#remember-password');\n                this.$submitBtn = $('#submit');\n                this.$spinner = $('#spinner');\n                this.$errors = $('#login-errors');\n\n                new Craft.PasswordInput(this.$passwordInput, {\n                    onToggleInput: $.proxy(function($newPasswordInput) {\n                        this.removeListener(this.$passwordInput, 'input');\n                        this.$passwordInput = $newPasswordInput;\n                        this.addListener(this.$passwordInput, 'input', 'onInput');\n                    }, this)\n                });\n\n                this.addListener(this.$loginNameInput, 'input', 'onInput')\n                this.addListener(this.$passwordInput, 'input', 'onInput');\n                this.addListener(this.$forgotPasswordLink, 'click', 'onSwitchForm');\n                this.addListener(this.$rememberPasswordLink, 'click', 'onSwitchForm');\n                this.addListener(this.$form, 'submit', 'onSubmit');\n            },\n\n            validate: function() {\n                if (this.$loginNameInput.val() && (this.forgotPassword || this.$passwordInput.val().length >= 6)) {\n                    this.clearErrors();\n                    return true;\n                }\n                else {\n                    return false;\n                }\n            },\n\n            onInput: function(event) {\n                if (this.validateOnInput) {\n                    this.validate();\n                }\n            },\n\n            onSubmit: function(event) {\n                // Prevent full HTTP submits\n                event.preventDefault();\n\n                if (!this.validate()) {\n                    this.showError(Craft.t('app', 'Couldnâ€™t log in. Please check your username or email and password.'));\n                    this.validateOnInput = true;\n                    return;\n                }\n\n                this.$submitBtn.addClass('active');\n                this.$spinner.removeClass('hidden');\n\n                this.clearErrors();\n\n                if (this.forgotPassword) {\n                    this.submitForgotPassword();\n                }\n                else {\n                    this.submitLogin();\n                }\n            },\n\n            submitForgotPassword: function() {\n                var data = {\n                    loginName: this.$loginNameInput.val()\n                };\n\n                Craft.postActionRequest('users/send-password-reset-email', data, $.proxy(function(response, textStatus) {\n                    if (textStatus === 'success') {\n                        if (response.success) {\n                            new MessageSentModal();\n                        }\n                        else {\n                            this.showError(response.error);\n                        }\n                    }\n\n                    this.onSubmitResponse();\n                }, this));\n            },\n\n            submitLogin: function() {\n                var data = {\n                    loginName: this.$loginNameInput.val(),\n                    password: this.$passwordInput.val(),\n                    rememberMe: (this.$rememberMeCheckbox.prop('checked') ? 'y' : '')\n                };\n\n                Craft.postActionRequest('users/login', data, $.proxy(function(response, textStatus) {\n                    if (textStatus === 'success') {\n                        if (response.success) {\n                            window.location.href = response.returnUrl;\n                        }\n                        else {\n                            Garnish.shake(this.$form);\n                            this.onSubmitResponse();\n\n                            // Add the error message\n                            this.showError(response.error);\n                        }\n                    }\n                    else {\n                        this.onSubmitResponse();\n                    }\n                }, this));\n\n                return false;\n            },\n\n            onSubmitResponse: function() {\n                this.$submitBtn.removeClass('active');\n                this.$spinner.addClass('hidden');\n            },\n\n            showError: function(error) {\n                this.clearErrors();\n\n                $('<p style=\"display: none;\">' + error + '</p>')\n                    .appendTo(this.$errors)\n                    .velocity('fadeIn');\n            },\n\n            clearErrors: function() {\n                this.$errors.empty();\n            },\n\n            onSwitchForm: function(event) {\n                if (!Garnish.isMobileBrowser()) {\n                    this.$loginNameInput.trigger('focus');\n                }\n\n                this.clearErrors();\n\n                this.forgotPassword = !this.forgotPassword;\n\n                this.$form.toggleClass('reset-password', this.forgotPassword);\n                this.$submitBtn.text(Craft.t('app', this.forgotPassword ? 'Reset Password': 'Login'));\n            },\n        });\n\n\n    var MessageSentModal = Garnish.Modal.extend(\n        {\n            init: function() {\n                var $container = $('<div class=\"modal fitted email-sent\"><div class=\"body\">' + Craft.t('app', 'Check your email for instructions to reset your password.') + '</div></div>')\n                    .appendTo(Garnish.$bod);\n\n                this.base($container);\n            },\n\n            hide: function() {\n            }\n        });\n\n\n    new LoginForm();\n})(jQuery);\n"]}