!function(){var e={d:function(t,a){for(var n in a)e.o(a,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:a[n]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r:function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};!function(){"use strict";e.r(t),e.d(t,{WebAuthnFormHandler:function(){return a}});class a{constructor(){this.attachEndpoint="authentication/attach-web-authn-credentials",this.disabled=!1,this.$container=$("#webauthn-settings"),this.attachEvents()}attachEvents(){a.$button=$("#attach-webauthn"),a.$button.on("click",(e=>{e.stopImmediatePropagation();const t=$(e.target).data("credential-options"),a=Object.assign(Object.assign({},t),{user:Object.assign({},t.user)});t.excludeCredentials&&(a.excludeCredentials=[...t.excludeCredentials]),a.challenge=atob(a.challenge.replace(/-/g,"+").replace(/_/g,"/")),a.user.id=atob(a.user.id.replace(/-/g,"+").replace(/_/g,"/")),a.challenge=Uint8Array.from(a.challenge,(e=>e.charCodeAt(0))),a.user.id=Uint8Array.from(a.user.id,(e=>e.charCodeAt(0)));for(const e in a.excludeCredentials){let t=a.excludeCredentials[e];a.excludeCredentials[e]={id:Uint8Array.from(atob(t.id.replace(/-/g,"+").replace(/_/g,"/")),(e=>e.charCodeAt(0))),type:t.type}}return this.createCredentials(a).then((e=>{Craft.elevatedSessionManager.requireElevatedSession((()=>this.attachWebAuthnCredential(e)))})).catch((e=>{console.log(e)})),!1}))}attachWebAuthnCredential(e){if(this.disabled)return!1;this.disable();const t={credentialName:prompt(Craft.t("app","Please enter a name for the credentials"),"Secure credentials"),credentials:{id:e.id,rawId:e.id,type:e.type,response:{attestationObject:btoa(String.fromCharCode(...new Uint8Array(e.response.attestationObject))),clientDataJSON:btoa(String.fromCharCode(...new Uint8Array(e.response.clientDataJSON)))}}};Craft.postActionRequest(this.attachEndpoint,t,((e,t)=>{e.html&&(this.$container.replaceWith(e.html),this.$container=$("#webauthn-settings"),this.attachEvents()),e.footHtml&&function(e){const t=e.match(/([^"']+\.js)/gm),a=Array.from(document.scripts).map((e=>e.getAttribute("src"))).filter((e=>e&&e.length>0));if(t){for(const e of t)if(!a.includes(e)){let t=document.createElement("script");t.setAttribute("src",e),document.body.appendChild(t)}}else Craft.appendFootHtml(e)}(e.footHtml),this.enable()}))}async createCredentials(e){const t=await navigator.credentials.create({publicKey:e}).catch((e=>{console.log(e)}));if(!t)throw"Failed to create credentials";return t}disable(){this.disabled=!0,a.$button.fadeTo(100,.5)}enable(){this.disabled=!1,a.$button.fadeTo(100,1)}static removeExcludedCredential(e){const t=a.$button.data("credential-options");let n=[];for(const a of t.excludeCredentials)a.id.replace(/[-_=+\/]/g,"")!==e.replace(/[-_=+\/]/g,"")&&n.push(a);t.excludeCredentials=n,a.$button.data("credential-options",t)}}a.$button=$("#attach-webauthn")}();var a=Craft="undefined"==typeof Craft?{}:Craft;for(var n in t)a[n]=t[n];t.__esModule&&Object.defineProperty(a,"__esModule",{value:!0})}();
//# sourceMappingURL=webAuthn.js.map