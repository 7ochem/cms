{"version":3,"file":"authForm.js","mappings":"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","sources":["webpack://Craft/webpack/bootstrap","webpack://Craft/webpack/runtime/define property getters","webpack://Craft/webpack/runtime/hasOwnProperty shorthand","webpack://Craft/webpack/runtime/make namespace object","webpack://Craft/./AuthenticatorFormHandler.ts","webpack://Craft/./AuthenticationSetupFormHandler.ts"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// define getter functions for harmony exports\n__webpack_require__.d = function(exports, definition) {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }","// define __esModule on exports\n__webpack_require__.r = function(exports) {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import { AuthenticationSetupFormHandler } from \"./AuthenticationSetupFormHandler\";\nvar OperationType;\n(function (OperationType) {\n    OperationType[OperationType[\"update\"] = 0] = \"update\";\n    OperationType[OperationType[\"remove\"] = 1] = \"remove\";\n})(OperationType || (OperationType = {}));\nexport class AuthenticatorFormHandler extends AuthenticationSetupFormHandler {\n    constructor() {\n        super(...arguments);\n        this.endpoint = 'authentication/update-authenticator-settings';\n        this.disabled = false;\n    }\n    get $container() {\n        return $('#authenticator-settings');\n    }\n    get $updateAuthenticator() {\n        return $('#update-authenticator');\n    }\n    get $removeAuthenticator() {\n        return $('#remove-authenticator');\n    }\n    get $authenticatorField() {\n        return $('#authenticator-code');\n    }\n    get $status() {\n        return $('#authenticator-status');\n    }\n    /**\n     * @inheritdoc\n     */\n    attachEvents() {\n        this.$authenticatorField.on('keydown', (event) => {\n            if (event.key == \"Enter\") {\n                event.stopImmediatePropagation();\n                this.handleAuthenticatorUpdate(OperationType.update);\n            }\n        });\n        this.$updateAuthenticator.on('click', (event) => {\n            event.stopImmediatePropagation();\n            this.handleAuthenticatorUpdate(OperationType.update);\n        });\n        this.$removeAuthenticator.on('click', (event) => {\n            event.stopImmediatePropagation();\n            this.handleAuthenticatorUpdate(OperationType.remove);\n        });\n    }\n    /**\n     * Handle authenticator setting update.\n     *\n     * @protected\n     */\n    handleAuthenticatorUpdate(type) {\n        if (this.disabled || (type == OperationType.update && this.$authenticatorField.val().length === 0)) {\n            return;\n        }\n        this.disable();\n        let data;\n        switch (type) {\n            case OperationType.update:\n                data = {\n                    'authenticator-code': this.$authenticatorField.val()\n                };\n                break;\n            case OperationType.remove:\n                data = {\n                    'detach': 'detach'\n                };\n        }\n        const submitUpdate = (payload) => {\n            this.setStatus(Craft.t('app', 'Updating the authenticator settings'));\n            Craft.sendActionRequest('POST', this.endpoint, { data: payload })\n                .then((response) => {\n                var _a, _b, _c;\n                this.enable();\n                if ((_a = response === null || response === void 0 ? void 0 : response.data) === null || _a === void 0 ? void 0 : _a.html) {\n                    this.$container.replaceWith(response.data.html);\n                    this.attachEvents();\n                }\n                if ((_b = response === null || response === void 0 ? void 0 : response.data) === null || _b === void 0 ? void 0 : _b.message) {\n                    this.setStatus(response.data.message, false, 750);\n                }\n                if ((_c = response === null || response === void 0 ? void 0 : response.data) === null || _c === void 0 ? void 0 : _c.codeHtml) {\n                    const $codeHtml = $('<div class=\"modal secure fitted\"></div>').append($(response.data.codeHtml));\n                    $codeHtml.find('#close-codes').on('click', () => {\n                        this.codeModal.hide();\n                    });\n                    this.codeModal = new Garnish.Modal($codeHtml, {\n                        closeOtherModals: false,\n                        hideOnEsc: false,\n                        hideOnShadeClick: false,\n                        onFadeOut: () => {\n                            $codeHtml.find('.codes').remove();\n                            this.codeModal.destroy();\n                            this.codeModal = null;\n                        },\n                    });\n                }\n            })\n                .catch(({ response }) => {\n                var _a;\n                this.enable();\n                if ((_a = response === null || response === void 0 ? void 0 : response.data) === null || _a === void 0 ? void 0 : _a.message) {\n                    this.setErrorStatus(response.data.message);\n                }\n            });\n        };\n        this.setStatus(Craft.t('app', 'Waiting for elevated session'));\n        Craft.elevatedSessionManager.requireElevatedSession(() => submitUpdate(data), () => {\n            this.enable();\n            this.clearStatus();\n        });\n    }\n    /**\n     * Disable the setting fields.\n     *\n     * @protected\n     */\n    disable() {\n        this.disabled = true;\n        this.$container.fadeTo(100, 0.5);\n    }\n    /**\n     * Enable the setting fields.\n     *\n     * @protected\n     */\n    enable() {\n        this.disabled = false;\n        this.$container.fadeTo(100, 1);\n    }\n}\n","export class AuthenticationSetupFormHandler {\n    constructor() {\n        this.attachEvents();\n    }\n    /**\n     * Clears the status and removes the spinner.\n     *\n     * @protected\n     */\n    clearStatus() {\n        this.setStatus('', false);\n    }\n    /**\n     * Display a status message and an optional spinner.\n     *\n     * @param message\n     * @param showSpinner\n     * @protected\n     */\n    setStatus(message, showSpinner = true, clearAfter = 0) {\n        if (showSpinner) {\n            message = `<div class=\"spinner\"></div><span>${message}</span>`;\n        }\n        this.$status.html(message);\n        if (clearAfter > 0) {\n            setTimeout(() => this.clearStatus(), clearAfter);\n        }\n    }\n    /**\n     * Set an error status for the user to see.\n     *\n     * @param message\n     * @protected\n     */\n    setErrorStatus(message) {\n        this.$status.html(`<div class=\"error\">${message}</div<`);\n    }\n}\n"],"names":["__webpack_require__","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","OperationType","AuthenticatorFormHandler","constructor","this","attachEvents","clearStatus","setStatus","message","showSpinner","clearAfter","$status","html","setTimeout","setErrorStatus","super","arguments","endpoint","disabled","$container","$","$updateAuthenticator","$removeAuthenticator","$authenticatorField","on","event","stopImmediatePropagation","handleAuthenticatorUpdate","update","remove","type","val","length","data","disable","submitUpdate","payload","Craft","t","sendActionRequest","then","response","_a","_b","_c","enable","replaceWith","codeHtml","$codeHtml","append","find","codeModal","hide","Garnish","Modal","closeOtherModals","hideOnEsc","hideOnShadeClick","onFadeOut","destroy","catch","elevatedSessionManager","requireElevatedSession","fadeTo"],"sourceRoot":""}