"use strict";var SessionStatus,IndexingActions;!function(s){s[s.ACTIONREQUIRED=0]="ACTIONREQUIRED",s[s.ACTIVE=1]="ACTIVE",s[s.QUEUE=2]="QUEUE"}(SessionStatus||(SessionStatus={})),function(s){s.STOP="asset-indexes/stop-indexing-session"}(IndexingActions||(IndexingActions={}));class AssetIndexer{constructor(s,e){this.indexingSessions={},this.$indexingSessionTable=s,this.indexingSessions={},this.currentIndexingSession=null;for(const s of e)this.updateIndexingSessionData(s)}updateIndexingSessionData(s){const e=this.createSessionFromModel(s);this.indexingSessions[e.getSessionId()]=e,this.renderIndexingSessionRow(e)}renderIndexingSessionRow(s){let e;if(!this.indexingSessions[s.getSessionId()])return this.$indexingSessionTable.find('tr[data-session-id="'+s.getSessionId()+'"]').remove(),void(0==this.$indexingSessionTable.find("tbody tr").length&&this.$indexingSessionTable.addClass("hidden"));e=s.getIndexingSessionRowHtml();const n=this.$indexingSessionTable.find('tr[data-session-id="'+s.getSessionId()+'"]');n.length>0?n.replaceWith(e):this.$indexingSessionTable.find("tbody").append(e),this.$indexingSessionTable.removeClass("hidden")}discardIndexingSession(s){const e=this.indexingSessions[s];delete this.indexingSessions[s],this.currentIndexingSession===s&&(this.currentIndexingSession=null),this.renderIndexingSessionRow(e)}processResponse(s,e){if("success"===e&&s.error)alert(s.error);else{if(s.session){const e=this.createSessionFromModel(s.session);this.indexingSessions[e.getSessionId()]=e,this.renderIndexingSessionRow(e),this.currentIndexingSession||(this.currentIndexingSession=e.getSessionId()),this.performIndexingStep()}s.stop&&this.discardIndexingSession(s.stop)}}performIndexingStep(){}stopIndexingSession(s){Craft.postActionRequest(IndexingActions.STOP,{sessionId:s},this.processResponse.bind(this))}createSessionFromModel(s){return new AssetIndexingSession(s,this)}}class AssetIndexingSession{constructor(s,e){this.indexingSessionData=s,this.indexer=e}getSessionId(){return this.indexingSessionData.id}getSessionStatus(){return this.indexingSessionData.queueId?SessionStatus.QUEUE:this.indexingSessionData.actionRequired?SessionStatus.ACTIONREQUIRED:SessionStatus.ACTIVE}getIndexingSessionRowHtml(){const s=$('<tr class="indexingSession" data-session-id="'+this.getSessionId()+'">');s.data("session-id",this.indexingSessionData.id).data("as-queue",this.indexingSessionData.queueId?this.indexingSessionData.queueId:null),s.append("<td>"+this.indexingSessionData.indexedVolumes+"</td>"),s.append("<td>"+this.indexingSessionData.dateCreated+"</td>"),s.append("<td>"+this.indexingSessionData.dateUpdated+"</td>");const e=$('<td class="progress"></td>').data("total",this.indexingSessionData.totalEntries).data("processed",this.indexingSessionData.processedEntries).css("position","relative"),n=new Craft.ProgressBar(e,!1);n.setItemCount(this.indexingSessionData.totalEntries),n.setProcessedItemCount(this.indexingSessionData.processedEntries),n.updateProgressBar(),n.showProgressBar(),s.append(e.data("progressBar",n)),s.append("<td>"+this.getSessionStatusMessage()+"</td>");const i=this.getActionButtons();return $("<td></td>").append(i).appendTo(s),s}getActionButtons(){if(this.getSessionStatus()===SessionStatus.QUEUE)return $();const s=$('<div class="buttons"></div>');if(this.getSessionStatus()==SessionStatus.ACTIONREQUIRED){const e=Craft.t("app","Review");s.append($("<button />",{type:"button",class:"btn submit",title:e,"aria-label":e}).text(e)).on("click",s=>{const e=$(s.target).parent();e.hasClass("disabled")||e.addClass("disabled")})}const e=Craft.t("app","Discard");return s.append($("<button />",{type:"button",class:"btn submit",title:e,"aria-label":e}).text(e)).on("click",e=>{s.hasClass("disabled")||(s.addClass("disabled"),this.indexer.stopIndexingSession(this.getSessionId()))}),s}getSessionStatusMessage(){switch(this.getSessionStatus()){case SessionStatus.ACTIONREQUIRED:return Craft.t("app","Waiting for review");case SessionStatus.ACTIVE:return Craft.t("app","Active");case SessionStatus.QUEUE:return Craft.t("app","Running in background")}}}
//# sourceMappingURL=AssetIndexer.min.js.map
