"use strict";class FocalPoint{constructor(t,i,s){this.visible=!1,this.dragging=!1,this.saving=!1,this.shouldSave=!1,this.lastX=0,this.lastY=0,this.debounceTimeout=1500,this.focalId="focal-point-"+Math.floor(99999*Math.random()),this.$target=t,this.$focal=$('<div class="preview-focal-point" id="'+this.focalId+'"><div class="inner"></div></div>').hide().appendTo(this.$target);const o=this.$target.find("img").data("focal");this.focalPos=o.split(";"),this.assetUid=this.$target.find("img").data("uid"),this.isCentered()?this.visible=!1:this.visible=!0,this.movable=s,this.$button=i,this.movable?(this.$button.on("click",()=>{this.toggleFocal()}),this.addFocalMoveListeners()):this.$focal.css({cursor:"auto"}),this.renderFocal()}addFocalMoveListeners(){this.$focal.on("mousedown touchstart",this.handleDragStart.bind(this)),$(window).on("mouseup touchend",this.handleDragEnd.bind(this)),$(window).on("mousemove touchmove",this.handleMove.bind(this))}destruct(){this.$focal.off("mousedown touchstart",this.handleDragStart.bind(this)),$(window).off("mouseup touchend",this.handleDragEnd.bind(this)),$(window).off("mousemove touchmove",this.handleMove.bind(this))}handleDragStart(t){this.dragging=this.movable,this.lastX=t.pageX,this.lastY=t.pageY}isCentered(){return.5==this.focalPos[0]&&.5==this.focalPos[1]}handleDragEnd(){this.dragging=!1}handleMove(t){if(t.preventDefault(),!this.dragging||this.saving)return;const i=t.pageX-this.lastX,s=t.pageY-this.lastY;0===s&&0===i||(this.shouldSave=!0),this.lastX=t.pageX,this.lastY=t.pageY;const o=this.$focal.position(),e=o.left+i+this.$focal.outerWidth()/2,a=o.top+s+this.$focal.outerHeight()/2,h=this.$target.width(),n=this.$target.height(),l=Math.min(Math.max(0,e),h),d=Math.min(Math.max(0,a),n);this.focalPos=[1/(h/l),1/(n/d)],this.debouncedSave(),this.positionFocal()}debouncedSave(){this.saving||(clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(()=>this.storeFocalPosition(),this.debounceTimeout))}storeFocalPosition(){this.saving=!0,this.renderButton();let t={assetUid:this.assetUid,focal:(this.visible?this.focalPos:[.5,.5]).join(";")};this.$button.parents(".buttons").css({opacity:1}),Craft.postActionRequest("assets/update-focal-position",t,()=>{this.saving=!1,this.shouldSave=!1,this.$button.parents(".buttons").css({opacity:""}),this.renderButton()})}toggleFocal(){this.saving||(this.visible=!this.visible,this.isCentered()||(this.shouldSave=!0),this.renderButton(),this.debouncedSave(),this.renderFocal())}renderButton(){this.saving?this.$button.text(Craft.t("app","Saving...")):this.visible?this.$button.text(Craft.t("app","Disable focal point")):this.$button.text(Craft.t("app","Enable focal point"))}renderFocal(){this.visible?(this.$focal.show(),this.positionFocal()):this.$focal.hide(),this.renderButton()}positionFocal(){this.$focal.css({left:this.$target.width()*this.focalPos[0]-this.$focal.outerWidth()/2,top:this.$target.height()*this.focalPos[1]-this.$focal.outerHeight()/2})}}
//# sourceMappingURL=FocalPoint.min.js.map
